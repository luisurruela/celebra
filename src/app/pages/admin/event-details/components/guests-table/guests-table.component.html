<!-- Formulario de invitados -->
<div class="mt-8">
  <h3 class="text-lg font-semibold text-gray-700 mb-2">Agregar Invitados</h3>
  <form [formGroup]="guestForm" (ngSubmit)="submit()">
    <div class="flex items-center gap-3">
      <input type="text" name="name" id="name" placeholder="Nombre del invitado"
        class="w-full px-2 py-1 border border-gray-300 rounded-none focus:outline-none focus:border-blue-500 text-gray-400"
        formControlName="name">
      <input type="number" min="1" name="guests" id="guests" placeholder="Asistentes"
        class="w-full px-2 py-1 border border-gray-300 rounded-none focus:outline-none focus:border-blue-500 text-gray-400"
        formControlName="allowed">
      <input type="email" name="email" id="email" placeholder="Correo"
        class="w-full px-2 py-1 border border-gray-300 rounded-none focus:outline-none focus:border-blue-500 text-gray-400"
        formControlName="email">
      <input type="text" name="phone" id="phone" placeholder="Teléfono"
        class="w-full px-2 py-1 border border-gray-300 rounded-none focus:outline-none focus:border-blue-500 text-gray-400"
        formControlName="phone">
      <app-button type="submit" [disabled]="guestForm.invalid">{{ isEditing ? 'Actualizar' : 'Agregar' }}</app-button>
    </div>
  </form>
</div>

<!-- Lista de invitados Registrados -->
 @if (guests$ | async; as guests) {
   @if (guests.length > 0) {
   <div class="mt-3">
      <table class="w-full border border-gray-300 table">
        <thead class="bg-gray-100">
          <tr class="text-center uppercase text-xs text-gray-500">
            <th class="px-4 py-2">Nombre</th>
            <th class="px-4 py-2">Asistentes</th>
            <th class="px-4 py-2">Contacto</th>
            <th class="px-4 py-2">Status</th>
            <th class="px-4 py-2">Acciones</th>
          </tr>
        </thead>
        <tbody>
         
          @for (guest of guests$ | async; track guest.id) {
          <tr class="text-center border-b border-gray-200 text-sm text-gray-600">
            <td class="text-start p-2 px-5">{{ guest.name }}</td>
            <td class="p-2">{{ guest.allowed }}</td>
            <td class="p-2">
              <app-action-button actionType="phone" color="gray" [disabled]="!guest.phone"/>
              <app-action-button actionType="email" color="gray" [disabled]="!guest.email" />
            </td>
            <td class="p-2">
              <div class="relative">
                <span class="material-symbols-outlined select-none text-gray-500 cursor-pointer" (click)="toggleMenu(guest.id!, $event)">
                  @if (guest.confirmed === guestStatus.Confirmed) {
                    check
                  }
                  
                  @else if (guest.confirmed === guestStatus.Declined) {
                    cancel
                  }
                  
                  @else if (!guest.confirmed || guest.confirmed === guestStatus.Pending) {
                    pending
                  }
                </span>

                @if (menuOpenFor === guest.id) {
                <div class="absolute bottom-10 z-50 bg-white p-1 rounded-sm shadow-sm whitespace-nowrap text-start" (appClickOutside)="menuOpenFor = null">
                  <ul class="cursor-pointer">
                    <li class="p-2 hover:bg-gray-100 transition-all duration-300" (click)="setStatus(guest.id!, guestStatus.Confirmed)">Confirmar</li>
                    <li class="p-2 hover:bg-gray-100 transition-all duration-300" (click)="setStatus(guest.id!, guestStatus.Declined)">Declinar</li>
                    <li class="p-2 hover:bg-gray-100 transition-all duration-300" (click)="setStatus(guest.id!, guestStatus.Pending)">Pendiente</li>
                  </ul>
                </div>
                }

              </div>
            </td>
            <td class="p-2">
              <app-action-button actionType="edit" color="blue" (clickAction)="editGuest(guest)" />
              <app-action-button actionType="share" color="blue" (clickAction)="shareGuest(guest.id!)" />
              <app-action-button actionType="delete" color="red" (clickAction)="deleteGuest(guest.id!)" />
            </td>
          </tr>
          }

        </tbody>
      </table>
    </div>
  }
  @else {
    <div class="mt-8 w-full bg-gray-50 p-10 text-center border border-gray-200 rounded-md">
      <p>No hay invitados registrados aún.</p>
    </div>
  }
 }